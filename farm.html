<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üåæ DNX FARM ULTRA++</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.min.js"></script>
<style>
:root{--gold:#ffd700;--neon:#00ffd5}
html,body{height:100%;margin:0}
body{
  color:#fff;font-family:Poppins,system-ui,sans-serif;text-align:center;
  background:url('dnx_logo.png') center/contain no-repeat fixed, radial-gradient(circle at top,#000 30%,#111 100%);
  background-blend-mode:overlay;backdrop-filter:brightness(.5);overflow-x:hidden;
}
h1{margin:40px 0 8px;font-size:2.4em;color:var(--gold);text-shadow:0 0 30px rgba(255,215,0,.7)}
#langToggle{position:fixed;top:18px;right:20px;padding:8px 14px;border-radius:10px;
  background:rgba(0,0,0,.6);border:1px solid var(--gold);color:var(--gold);cursor:pointer;font-weight:700}
.card{
  width:min(560px,95vw);margin:25px auto;padding:26px;background:rgba(0,0,0,.7);
  border:2px solid var(--gold);border-radius:18px;box-shadow:0 0 25px rgba(255,215,0,.4);
}
.stat{display:flex;justify-content:space-between;margin:6px 0;font-size:15px}
.label{opacity:.85}.value{font-weight:700;color:var(--gold)}
input{
  width:80%;padding:10px;margin:12px auto;border-radius:10px;border:1px solid var(--neon);
  background:rgba(0,0,0,.8);color:var(--neon);text-align:center;
}
button{
  margin:6px;padding:11px 18px;border:0;border-radius:14px;font-weight:700;cursor:pointer;
  background:linear-gradient(90deg,#00ffd5,#00c8a7);color:#000;transition:.2s;
}
button:hover{transform:scale(1.05);background:linear-gradient(90deg,#ffd700,#ff9500)}
footer{margin-top:40px;font-size:14px;color:#ccc}
#priceBox{margin:12px;font-size:16px;color:var(--neon)}
svg{width:90%;max-width:500px;height:120px;margin:auto;display:block}
</style>
</head>
<body>
<button id="langToggle">EN</button>
<h1 id="title">üåæ DNX FARM ULTRA++</h1>
<p id="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å Ecosystem ‡∏Ç‡∏≠‡∏á Dynamix</p>

<div class="card">
  <div class="stat"><div class="label" id="walletLabel">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</div><div id="waddr" class="value">‚Äî</div></div>
  <div class="stat"><div class="label" id="balLabel">‡∏¢‡∏≠‡∏î DNX ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="bal" class="value">‚Äî</div></div>
  <div class="stat"><div class="label" id="stakeLabel">‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á Stake</div><div id="staked" class="value">‚Äî</div></div>
  <div class="stat"><div class="label" id="pendLabel">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</div><div id="pending" class="value">‚Äî</div></div>
  <div id="priceBox">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô DNX/BNB ‚âà <span id="price">‚Äî</span></div>

  <input id="amount" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX" />
  <div>
    <button id="setMax">MAX</button>
    <button id="deposit">üí∞ Deposit</button>
    <button id="withdraw">üíé Withdraw</button>
    <button id="claim">üéÅ Claim</button>
    <button id="refresh">üîÑ Refresh</button>
  </div>
</div>

<svg id="chart" viewBox="0 0 500 120"><polyline fill="none" stroke="#00ffd5" stroke-width="3" points=""/></svg>

<footer>Powered by <b>DNX Finance</b> ¬© 2025</footer>

<script>
const CHEF='0x9D9649e1710eF013465C34146874F967EEE73B03';
const TOKEN='0x7DB860CC9D7f64Ed1B39de6621ebc94440C8dc62';
const CHAIN='0x38';
const ABIchef=[
 "function deposit(uint256) external","function withdraw(uint256) external",
 "function userInfo(address) view returns(uint256 amount,uint256 rewardDebt)",
 "function accDNXPerShare() view returns(uint256)","function lastRewardBlock() view returns(uint256)",
 "function rewardPerBlock() view returns(uint256)"
];
const ABItoken=[
 "function balanceOf(address) view returns(uint256)",
 "function decimals() view returns(uint8)",
 "function allowance(address,address)view returns(uint256)",
 "function approve(address,uint256) returns(bool)"
];
let provider,signer,chef,token,user,dec=18;

const $=id=>document.getElementById(id);
const fmt=v=>Number(ethers.formatUnits(v,dec)).toLocaleString(undefined,{maximumFractionDigits:6});

async function connect(){
 if(!window.ethereum)return alert(msg('needMM'));
 provider=new ethers.BrowserProvider(window.ethereum);
 await provider.send("eth_requestAccounts",[]);
 signer=await provider.getSigner(); user=await signer.getAddress();
 chef=new ethers.Contract(CHEF,ABIchef,signer); token=new ethers.Contract(TOKEN,ABItoken,signer);
 dec=await token.decimals(); $('waddr').textContent=user.slice(0,6)+'...'+user.slice(-4);
 refreshAll(); setInterval(refreshAll,10000);
}
async function refreshAll(){
 if(!signer)return;
 const [bal,info]=await Promise.all([token.balanceOf(user),chef.userInfo(user)]);
 $('bal').textContent=fmt(bal); $('staked').textContent=fmt(info.amount);
 $('pending').textContent='‚ü≥'; updatePending(info);
 fetchPrice(); drawChart();
}
async function updatePending(info){
 const [acc,last,rpb,supply,block]=await Promise.all([
  chef.accDNXPerShare(),chef.lastRewardBlock(),chef.rewardPerBlock(),
  token.balanceOf(CHEF),provider.getBlockNumber()
 ]);
 let acc2=acc;if(block>Number(last)&&supply>0n){
  const reward=(BigInt(block)-BigInt(last))*rpb;
  acc2+=reward*1000000000000n/supply;
 }
 const pending=(info.amount*acc2)/1000000000000n-info.rewardDebt;
 $('pending').textContent=fmt(pending);
}
async function act(fn,amt){
 try{
  if(!signer)return alert(msg('needMM'));
  const val=$('amount').value.trim(); if(!val)return alert(msg('enterAmt'));
  const v=ethers.parseUnits(val,dec);
  if(fn==='deposit'){
    const allowance=await token.allowance(user,CHEF);
    if(allowance<v){const txa=await token.approve(CHEF,v);await txa.wait();}
  }
  const tx=await chef[fn](v); await tx.wait();
  alert(msg('success')); $('amount').value=''; refreshAll();
 }catch(e){alert(msg('fail')+e.message);}
}
async function claim(){
 try{const tx=await chef.deposit(0);await tx.wait();alert(msg('claimed'));refreshAll();}
 catch(e){alert(msg('fail')+e.message);}
}
async function setMax(){
 const bal=await token.balanceOf(user);
 $('amount').value=Number(ethers.formatUnits(bal,dec)).toFixed(6);
}
$('deposit').onclick=()=>act('deposit');
$('withdraw').onclick=()=>act('withdraw');
$('claim').onclick=claim;
$('refresh').onclick=refreshAll;
$('setMax').onclick=setMax;
connect();

/* === price & mini chart === */
async function fetchPrice(){
 try{
  const res=await fetch("https://api.pancakeswap.info/api/v2/tokens/"+TOKEN);
  const data=await res.json();
  $('price').textContent=parseFloat(data.data.price_BNB).toFixed(8);
 }catch{ $('price').textContent='‚Äî'; }
}
async function drawChart(){
 const pts=Array.from({length:30},(_,i)=>[i*17,70+Math.sin(Date.now()/1000+i)*20]);
 $('chart').querySelector('polyline').setAttribute('points',pts.map(p=>p.join(',')).join(' '));
}

/* === bilingual toggle === */
let lang='th';
const text={
 th:{title:"üåæ DNX FARM ULTRA++",subtitle:"‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å Ecosystem ‡∏Ç‡∏≠‡∏á Dynamix",
      walletLabel:"‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤",balLabel:"‡∏¢‡∏≠‡∏î DNX ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",stakeLabel:"‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á Stake",
      pendLabel:"‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö",needMM:"‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MetaMask ‡∏Å‡πà‡∏≠‡∏ô !",
      enterAmt:"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX !",success:"‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à !",fail:"‚ùå ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ",
      claimed:"üéÅ ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡πâ‡∏ß !"},
 en:{title:"üåæ DNX FARM ULTRA++",subtitle:"Stake your DNX to earn rewards from the Dynamix ecosystem.",
      walletLabel:"Wallet",balLabel:"DNX Balance",stakeLabel:"Staked Amount",
      pendLabel:"Pending Reward",needMM:"‚ö†Ô∏è Please install MetaMask first!",
      enterAmt:"Please enter DNX amount!",success:"‚úÖ Success!",fail:"‚ùå Transaction failed: ",
      claimed:"üéÅ Reward claimed!"}
};
function msg(k){return text[lang][k]||k;}
$('langToggle').onclick=()=>{
 lang=lang==='th'?'en':'th';$('langToggle').textContent=lang==='th'?'EN':'TH';
 for(const k of ['title','subtitle','walletLabel','balLabel','stakeLabel','pendLabel'])
   $(k).textContent=text[lang][k];
};
</script>
</body>
</html>
